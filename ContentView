//
//  ContentView.swift
//  TestBet
//
//  Created by Varja S on 08.02.2025.
//

import SwiftUI

struct UserCredentials: Codable {
    let login: String
    let password: String
}

struct UserProfile: Codable {
    let firstName: String
    let lastName: String
    let phone: String
    let email: String
    let city: String
    let birthDate: Date
    let credentials: UserCredentials
}

class UserData: ObservableObject {
    @Published var profile: UserProfile? {
        didSet {
            if let profile = profile {
                let encoder = JSONEncoder()
                if let encoded = try? encoder.encode(profile) {
                    UserDefaults.standard.set(encoded, forKey: "userProfile")
                }
            }
        }
    }
    
    @Published var isLoggedIn: Bool {
        didSet {
            UserDefaults.standard.set(isLoggedIn, forKey: "isLoggedIn")
        }
    }
    
    init() {
        self.isLoggedIn = UserDefaults.standard.bool(forKey: "isLoggedIn")
        
        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å, –µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if UserDefaults.standard.data(forKey: "userProfile") == nil {
            let testCredentials = UserCredentials(login: "test", password: "test")
            let testProfile = UserProfile(
                firstName: "Test",
                lastName: "User",
                phone: "+7 999 999 99 99",
                email: "test@example.com",
                city: "Cyprus",
                birthDate: Date(),
                credentials: testCredentials
            )
            self.profile = testProfile
            
            let encoder = JSONEncoder()
            if let encoded = try? encoder.encode(testProfile) {
                UserDefaults.standard.set(encoded, forKey: "userProfile")
            }
        } else {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –≥–æ—Ä–æ–¥
            if let savedProfile = UserDefaults.standard.data(forKey: "userProfile"),
               let decodedProfile = try? JSONDecoder().decode(UserProfile.self, from: savedProfile) {
                let updatedProfile = UserProfile(
                    firstName: decodedProfile.firstName,
                    lastName: decodedProfile.lastName,
                    phone: decodedProfile.phone,
                    email: decodedProfile.email,
                    city: "Cyprus",
                    birthDate: decodedProfile.birthDate,
                    credentials: decodedProfile.credentials
                )
                self.profile = updatedProfile
                
                let encoder = JSONEncoder()
                if let encoded = try? encoder.encode(updatedProfile) {
                    UserDefaults.standard.set(encoded, forKey: "userProfile")
                }
            }
        }
    }
    
    func validateCredentials(login: String, password: String) -> Bool {
        guard let profile = profile else { return false }
        return profile.credentials.login == login && profile.credentials.password == password
    }
}

struct RegistrationView: View {
    @State private var firstName = ""
    @State private var lastName = ""
    @State private var phone = ""
    @State private var email = ""
    @State private var city = ""
    @State private var birthDate = Date()
    @State private var isRegistered = false
    @State private var showingCredentials = false
    @State private var generatedCredentials: UserCredentials?
    @StateObject private var userData = UserData()
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            ScrollView {
                VStack(spacing: 20) {
                    Text("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è")
                        .font(.largeTitle)
                        .foregroundColor(.white)
                        .padding(.top, 30)
                    
                    VStack(spacing: 15) {
                        TextField("–ò–º—è", text: $firstName)
                            .textFieldStyle(CustomTextFieldStyle())
                        
                        TextField("–§–∞–º–∏–ª–∏—è", text: $lastName)
                            .textFieldStyle(CustomTextFieldStyle())
                        
                        TextField("–¢–µ–ª–µ—Ñ–æ–Ω", text: $phone)
                            .textFieldStyle(CustomTextFieldStyle())
                            .keyboardType(.phonePad)
                        
                        TextField("Email", text: $email)
                            .textFieldStyle(CustomTextFieldStyle())
                            .keyboardType(.emailAddress)
                            .autocapitalization(.none)
                        
                        TextField("–ì–æ—Ä–æ–¥", text: $city)
                            .textFieldStyle(CustomTextFieldStyle())
                        
                        DatePicker("–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è", selection: $birthDate, 
                                 displayedComponents: .date)
                            .datePickerStyle(.compact)
                            .foregroundColor(.white)
                            .padding()
                            .background(
                                RoundedRectangle(cornerRadius: 15)
                                    .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                            )
                    }
                    .padding(.horizontal)
                    
                    Button(action: {
                        if isFormValid() {
                            generateCredentials()
                            showingCredentials = true
                        }
                    }) {
                        Text("–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è")
                            .font(.title3)
                            .bold()
                            .foregroundColor(.white)
                            .frame(maxWidth: .infinity)
                            .frame(height: 50)
                            .background(
                                RoundedRectangle(cornerRadius: 25)
                                    .fill(Color.blue.opacity(0.8))
                            )
                    }
                }
                .padding(.bottom, 30)
            }
        }
        .alert("–í–∞—à–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", isPresented: $showingCredentials) {
            Button("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å") {
                if let credentials = generatedCredentials {
                    saveUserProfile(credentials: credentials)
                    isRegistered = true
                }
            }
        } message: {
            if let credentials = generatedCredentials {
                Text("–õ–æ–≥–∏–Ω: \(credentials.login)\n–ü–∞—Ä–æ–ª—å: \(credentials.password)\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ!")
            }
        }
        .fullScreenCover(isPresented: $isRegistered) {
            TabView(selection: .constant(2)) {
                ProfileView()
                    .environmentObject(userData)
                    .tabItem {
                        FooterButton(icon: "person.fill", title: "–ü—Ä–æ—Ñ–∏–ª—å", isSelected: false)
                    }
                    .tag(0)
                
                CategoriesView()
                    .tabItem {
                        FooterButton(icon: "line.3.horizontal", title: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏", isSelected: false)
                    }
                    .tag(1)
                
                MainGameView()
                    .tabItem {
                        FooterButton(icon: "house.fill", title: "–ì–ª–∞–≤–Ω–∞—è", isSelected: true)
                    }
                    .tag(2)
                
                BetSlipView()
                    .tabItem {
                        FooterButton(icon: "ticket.fill", title: "–ö—É–ø–æ–Ω", isSelected: false)
                    }
                    .tag(3)
                
                SettingsView()
                    .tabItem {
                        FooterButton(icon: "gearshape.fill", title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", isSelected: false)
                    }
                    .tag(4)
            }
            .accentColor(.blue)
        }
    }
    
    private func isFormValid() -> Bool {
        return !firstName.isEmpty && !lastName.isEmpty && !phone.isEmpty && 
               !email.isEmpty && !city.isEmpty
    }
    
    private func generateCredentials() -> Void {
        let login = "\(firstName.lowercased()).\(lastName.lowercased())"
        let password = String((0..<8).map { _ in "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".randomElement()! })
        generatedCredentials = UserCredentials(login: login, password: password)
    }
    
    private func saveUserProfile(credentials: UserCredentials) {
        let profile = UserProfile(
            firstName: firstName,
            lastName: lastName,
            phone: phone,
            email: email,
            city: city,
            birthDate: birthDate,
            credentials: credentials
        )
        userData.profile = profile
    }
}

struct CustomTextFieldStyle: TextFieldStyle {
    func _body(configuration: TextField<Self._Label>) -> some View {
        configuration
            .padding()
            .background(
                RoundedRectangle(cornerRadius: 15)
                    .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
            )
            .foregroundColor(.white)
    }
}

struct ImageSlider: View {
    @State private var currentIndex = 0
    private let imageUrls = [
        "https://i.ibb.co/JFkwZPFt/DALL-E-2025-02-08-21-17-27-A-rectangular-sports-betting-banner-The-image-features-a-high-energy-spor.webp",
        "https://i.ibb.co/nsN7Dp6Y/DALL-E-2025-02-08-21-20-34-A-wide-casino-banner-with-a-luxurious-casino-theme-The-image-features-a-r.webp",
        "https://i.ibb.co/bRXLx1f6/DALL-E-2025-02-08-21-21-13-A-wide-esports-banner-with-a-high-tech-and-competitive-gaming-theme-The-i.webp"
    ]
    
    var body: some View {
        TabView(selection: $currentIndex) {
            ForEach(0..<imageUrls.count, id: \.self) { index in
                AsyncImage(url: URL(string: imageUrls[index])) { phase in
                    switch phase {
                    case .empty:
                        ProgressView()
                    case .success(let image):
                        image
                            .resizable()
                            .aspectRatio(contentMode: .fill)
                            .clipped()
                    case .failure(_):
                        Rectangle()
                            .fill(Color.gray.opacity(0.3))
                            .overlay(
                                Image(systemName: "photo")
                                    .foregroundColor(.white)
                            )
                    @unknown default:
                        EmptyView()
                    }
                }
            }
        }
        .tabViewStyle(PageTabViewStyle())
        .frame(height: 200)
    }
}

struct SportCategory: Identifiable {
    let id = UUID()
    let name: String
    let icon: String
}

struct ExpandableCategory: Identifiable {
    let id = UUID()
    let title: String
    var isExpanded: Bool
    let sports: [SportCategory]
}

struct CategoriesView: View {
    @State private var categories: [ExpandableCategory] = [
        ExpandableCategory(
            title: "–ò–≥—Ä–æ–≤—ã–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞",
            isExpanded: false,
            sports: [
                SportCategory(name: "–§—É—Ç–±–æ–ª", icon: "‚öΩÔ∏è"),
                SportCategory(name: "–ë–∞—Å–∫–µ—Ç–±–æ–ª", icon: "üèÄ"),
                SportCategory(name: "–í–æ–ª–µ–π–±–æ–ª", icon: "üèê"),
                SportCategory(name: "–•–æ–∫–∫–µ–π", icon: "üèí"),
                SportCategory(name: "–¢–µ–Ω–Ω–∏—Å", icon: "üéæ"),
                SportCategory(name: "–ì–∞–Ω–¥–±–æ–ª", icon: "ü§æ")
            ]
        ),
        ExpandableCategory(
            title: "–ï–¥–∏–Ω–æ–±–æ—Ä—Å—Ç–≤–∞",
            isExpanded: false,
            sports: [
                SportCategory(name: "–ë–æ–∫—Å", icon: "ü•ä"),
                SportCategory(name: "–ë–æ—Ä—å–±–∞", icon: "ü§º"),
                SportCategory(name: "–î–∑—é–¥–æ", icon: "ü•ã"),
                SportCategory(name: "–ö–∞—Ä–∞—Ç–µ", icon: "ü•ã"),
                SportCategory(name: "–¢—Ö—ç–∫–≤–æ–Ω–¥–æ", icon: "ü•ã"),
                SportCategory(name: "–°–∞–º–±–æ", icon: "ü§º"),
                SportCategory(name: "MMA", icon: "ü•ä")
            ]
        ),
        ExpandableCategory(
            title: "–°–∏–ª–æ–≤—ã–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞",
            isExpanded: false,
            sports: [
                SportCategory(name: "–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", icon: "üèãÔ∏è"),
                SportCategory(name: "–ü–∞—É—ç—Ä–ª–∏—Ñ—Ç–∏–Ω–≥", icon: "üèãÔ∏è‚Äç‚ôÇÔ∏è"),
                SportCategory(name: "–ë–æ–¥–∏–±–∏–ª–¥–∏–Ω–≥", icon: "üí™"),
                SportCategory(name: "–ö—Ä–æ—Å—Å—Ñ–∏—Ç", icon: "üèãÔ∏è‚Äç‚ôÄÔ∏è")
            ]
        ),
        ExpandableCategory(
            title: "–õ–µ–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞",
            isExpanded: false,
            sports: [
                SportCategory(name: "–ë–µ–≥", icon: "üèÉ"),
                SportCategory(name: "–ü—Ä—ã–∂–∫–∏", icon: "ü¶ò"),
                SportCategory(name: "–ú–µ—Ç–∞–Ω–∏—è", icon: "üéØ"),
                SportCategory(name: "–•–æ–¥—å–±–∞", icon: "üö∂")
            ]
        ),
        ExpandableCategory(
            title: "–ö—Ä–∏–ø—Ç–æ-–∫–∞–∑–∏–Ω–æ",
            isExpanded: false,
            sports: []
        ),
        ExpandableCategory(
            title: "Live-–∫–∞–∑–∏–Ω–æ",
            isExpanded: false,
            sports: []
        ),
        ExpandableCategory(
            title: "–¢–∞–ø–∞–ª–∫–∏",
            isExpanded: false,
            sports: [
                SportCategory(name: "–ú—è—á–∏–∫ —Å—É–¥—å–±—ã", icon: "üèÄ")
            ]
        )
    ]
    
    var body: some View {
        NavigationView {
            ZStack {
                Color(red: 0.1, green: 0.1, blue: 0.2)
                    .ignoresSafeArea()
                
                ScrollView {
                    VStack(spacing: 15) {
                        ForEach($categories) { $category in
                            VStack(spacing: 0) {
                                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                Button(action: {
                                    withAnimation {
                                        category.isExpanded.toggle()
                                    }
                                }) {
                                    HStack {
                                        Text(category.title)
                                            .font(.title3)
                                            .fontWeight(.medium)
                                            .foregroundColor(.white)
                                        
                                        Spacer()
                                        
                                        Image(systemName: category.isExpanded ? "chevron.up" : "chevron.down")
                                            .foregroundColor(.white)
                                            .font(.system(size: 16, weight: .medium))
                                    }
                                    .padding()
                                    .background(
                                        RoundedRectangle(cornerRadius: 15)
                                            .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                    )
                                }
                                
                                // –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞
                                if category.isExpanded {
                                    VStack(spacing: 1) {
                                        ForEach(category.sports) { sport in
                                            NavigationLink(destination: sport.name == "–ú—è—á–∏–∫ —Å—É–¥—å–±—ã" ? AnyView(BallGameView()) : AnyView(EmptyBonusView())) {
                                                HStack {
                                                    Text(sport.icon)
                                                        .font(.title3)
                                                    Text(sport.name)
                                                        .foregroundColor(.white)
                                                    Spacer()
                                                    Image(systemName: "chevron.right")
                                                        .foregroundColor(.gray)
                                                        .font(.system(size: 14))
                                                }
                                                .padding()
                                                .background(Color(red: 0.15, green: 0.15, blue: 0.25))
                                            }
                                        }
                                    }
                                    .background(Color(red: 0.2, green: 0.2, blue: 0.3))
                                    .clipShape(RoundedRectangle(cornerRadius: 15))
                                    .padding(.top, 1)
                                }
                            }
                        }
                    }
                    .padding()
                }
            }
        }
    }
}

struct GameBlock: View {
    let game: String
    let team1: String
    let team2: String
    let odds: (String, String, String)
    
    var body: some View {
        VStack(alignment: .leading, spacing: 10) {
            Text(game)
                .font(.headline)
                .foregroundColor(.white)
            
            VStack(alignment: .leading, spacing: 5) {
                Text(team1)
                    .foregroundColor(.white)
                Text(team2)
                    .foregroundColor(.white)
            }
            
            HStack(spacing: 10) {
                ForEach([odds.0, odds.1, odds.2], id: \.self) { odd in
                    Button(action: {}) {
                        Text(odd)
                            .foregroundColor(.white)
                            .frame(maxWidth: .infinity)
                            .frame(height: 40)
                            .background(
                                RoundedRectangle(cornerRadius: 10)
                                    .fill(Color.blue.opacity(0.3))
                            )
                    }
                }
            }
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 15)
                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
        )
    }
}

struct FooterButton: View {
    let icon: String
    let title: String
    let isSelected: Bool
    
    var body: some View {
        VStack {
            Image(systemName: icon)
                .font(.system(size: 22))
            Text(title)
                .font(.system(size: 12))
        }
        .foregroundColor(isSelected ? .blue : .gray)
    }
}

struct ProfileView: View {
    @EnvironmentObject var userData: UserData
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            if let profile = userData.profile {
                ScrollView {
                    VStack(spacing: 20) {
                        Text("\(profile.firstName) \(profile.lastName)")
                            .font(.title)
                            .foregroundColor(.white)
                        
                        VStack(spacing: 15) {
                            ProfileInfoRow(title: "Email", value: profile.email)
                            ProfileInfoRow(title: "–¢–µ–ª–µ—Ñ–æ–Ω", value: profile.phone)
                            ProfileInfoRow(title: "–ì–æ—Ä–æ–¥", value: profile.city)
                            ProfileInfoRow(title: "–õ–æ–≥–∏–Ω", value: profile.credentials.login)
                            ProfileInfoRow(title: "–ü–∞—Ä–æ–ª—å", value: profile.credentials.password)
                        }
                        .padding()
                        .background(
                            RoundedRectangle(cornerRadius: 15)
                                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                        )
                        .padding(.horizontal)
                    }
                    .padding(.vertical)
                }
            } else {
                Text("–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
                    .foregroundColor(.white)
            }
        }
    }
}

struct ProfileInfoRow: View {
    let title: String
    let value: String
    
    var body: some View {
        HStack {
            Text(title)
                .foregroundColor(.gray)
            Spacer()
            Text(value)
                .foregroundColor(.white)
        }
    }
}

struct BetSlipView: View {
    @State private var selectedOption = 0
    @State private var numberOfCoupons: Double = 1
    @State private var partialAmount: Double = 100
    @State private var promoCode = ""
    @State private var showPromoCodeAlert = false
    @State private var promoCodeMessage = ""
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            VStack(spacing: 20) {
                // –°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è
                Picker("–û–ø—Ü–∏–∏", selection: $selectedOption) {
                    Text("–ö—É–ø–∏—Ç—å").tag(0)
                    Text("–ü—Ä–æ–¥–∞—Ç—å").tag(1)
                    Text("–ü—Ä–æ–¥–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ").tag(2)
                }
                .pickerStyle(SegmentedPickerStyle())
                .padding()
                .background(Color(red: 0.2, green: 0.2, blue: 0.3))
                
                ScrollView {
                    VStack(spacing: 20) {
                        // –ü–æ–ª–µ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
                        VStack(spacing: 15) {
                            Text("–ü—Ä–æ–º–æ–∫–æ–¥")
                                .font(.headline)
                                .foregroundColor(.white)
                            
                            HStack {
                                TextField("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥", text: $promoCode)
                                    .textFieldStyle(CustomTextFieldStyle())
                                    .autocapitalization(.none)
                                
                                Button(action: {
                                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
                                    promoCodeMessage = "–ü—Ä–æ–º–æ–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω"
                                    showPromoCodeAlert = true
                                }) {
                                    Text("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å")
                                        .font(.headline)
                                        .foregroundColor(.white)
                                        .frame(width: 100, height: 44)
                                        .background(Color.blue.opacity(0.8))
                                        .cornerRadius(10)
                                }
                            }
                            .padding(.horizontal)
                        }
                        .padding()
                        .background(
                            RoundedRectangle(cornerRadius: 15)
                                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                        )
                        .padding(.horizontal)
                        
                        // –ë–ª–æ–∫ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏
                        VStack(spacing: 15) {
                            if selectedOption == 0 {
                                // –ö—É–ø–∏—Ç—å –∫—É–ø–æ–Ω
                                BetSlipActionBlock(
                                    title: "–ö—É–ø–∏—Ç—å –∫—É–ø–æ–Ω",
                                    value: $numberOfCoupons,
                                    range: 1...10,
                                    step: 1,
                                    format: "%.0f –∫—É–ø–æ–Ω–æ–≤",
                                    actionTitle: "–ö—É–ø–∏—Ç—å",
                                    actionColor: .green
                                )
                            } else if selectedOption == 1 {
                                // –ü—Ä–æ–¥–∞—Ç—å –∫—É–ø–æ–Ω
                                BetSlipActionBlock(
                                    title: "–ü—Ä–æ–¥–∞—Ç—å –∫—É–ø–æ–Ω",
                                    value: $numberOfCoupons,
                                    range: 1...10,
                                    step: 1,
                                    format: "%.0f –∫—É–ø–æ–Ω–æ–≤",
                                    actionTitle: "–ü—Ä–æ–¥–∞—Ç—å",
                                    actionColor: .red
                                )
                            } else {
                                // –ü—Ä–æ–¥–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ
                                BetSlipActionBlock(
                                    title: "–ü—Ä–æ–¥–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ",
                                    value: $partialAmount,
                                    range: 100...1000,
                                    step: 100,
                                    format: "%.0f ‚Ç¨",
                                    actionTitle: "–ü—Ä–æ–¥–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ",
                                    actionColor: .orange
                                )
                            }
                        }
                        .padding()
                        .background(
                            RoundedRectangle(cornerRadius: 15)
                                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                        )
                        .padding(.horizontal)
                    }
                }
            }
        }
        .alert("–ü—Ä–æ–º–æ–∫–æ–¥", isPresented: $showPromoCodeAlert) {
            Button("OK", role: .cancel) { }
        } message: {
            Text(promoCodeMessage)
        }
    }
}

struct BetSlipActionBlock: View {
    let title: String
    @Binding var value: Double
    let range: ClosedRange<Double>
    let step: Double
    let format: String
    let actionTitle: String
    let actionColor: Color
    
    var body: some View {
        VStack(spacing: 15) {
            Text(title)
                .font(.headline)
                .foregroundColor(.white)
            
            // –°–ª–∞–π–¥–µ—Ä
            VStack {
                Slider(value: $value, in: range, step: step)
                    .accentColor(actionColor)
                Text(String(format: format, value))
                    .foregroundColor(.white)
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            HStack(spacing: 15) {
                // –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (–ö—É–ø–∏—Ç—å/–ü—Ä–æ–¥–∞—Ç—å)
                Button(action: {
                    // –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
                }) {
                    Text(actionTitle)
                        .font(.headline)
                        .foregroundColor(.white)
                        .frame(maxWidth: .infinity)
                        .frame(height: 44)
                        .background(actionColor.opacity(0.8))
                        .cornerRadius(10)
                }
                
                // –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã
                Button(action: {
                    // –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ
                }) {
                    Text("–û—Ç–º–µ–Ω–∞")
                        .font(.headline)
                        .foregroundColor(.white)
                        .frame(maxWidth: .infinity)
                        .frame(height: 44)
                        .background(Color.gray.opacity(0.8))
                        .cornerRadius(10)
                }
            }
        }
    }
}

struct SettingsView: View {
    @EnvironmentObject var userData: UserData
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            VStack {
                Text("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
                    .foregroundColor(.white)
                
                Button(action: {
                    userData.isLoggedIn = false
                }) {
                    Text("–í—ã–π—Ç–∏")
                        .font(.title3)
                        .bold()
                        .foregroundColor(.white)
                        .frame(maxWidth: .infinity)
                        .frame(height: 50)
                        .background(
                            RoundedRectangle(cornerRadius: 25)
                                .fill(Color.red.opacity(0.8))
                        )
                        .padding(.horizontal)
                }
                .padding(.top, 20)
            }
        }
    }
}

struct GameView: View {
    @State private var selectedTab = 2
    
    var body: some View {
        TabView(selection: $selectedTab) {
            ProfileView()
                .tabItem {
                    FooterButton(icon: "person.fill", title: "–ü—Ä–æ—Ñ–∏–ª—å", isSelected: selectedTab == 0)
                }
                .tag(0)
            
            CategoriesView()
                .tabItem {
                    FooterButton(icon: "line.3.horizontal", title: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏", isSelected: selectedTab == 1)
                }
                .tag(1)
            
            MainGameView()
                .tabItem {
                    FooterButton(icon: "house.fill", title: "–ì–ª–∞–≤–Ω–∞—è", isSelected: selectedTab == 2)
                }
                .tag(2)
            
            BetSlipView()
                .tabItem {
                    FooterButton(icon: "ticket.fill", title: "–ö—É–ø–æ–Ω", isSelected: selectedTab == 3)
                }
                .tag(3)
            
            SettingsView()
                .tabItem {
                    FooterButton(icon: "gearshape.fill", title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", isSelected: selectedTab == 4)
                }
                .tag(4)
        }
        .accentColor(.blue)
    }
}

struct CategorySquare: View {
    let title: String
    
    var body: some View {
        VStack {
            Text(title)
                .font(.headline)
                .foregroundColor(.white)
                .frame(maxWidth: .infinity)
                .frame(height: 80)
                .background(
                    RoundedRectangle(cornerRadius: 15)
                        .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                )
        }
    }
}

struct BonusImageSlider: View {
    @State private var currentIndex = 0
    private let imageUrls = [
        "https://i.ibb.co/zVFL3sb7/DALL-E-2025-02-08-22-07-05-A-wide-casino-bonus-gift-banner-The-image-features-a-glowing-gift-box-wra.webp",
        "https://i.ibb.co/zVFL3sb7/DALL-E-2025-02-08-22-07-05-A-wide-casino-bonus-gift-banner-The-image-features-a-glowing-gift-box-wra.webp",
        "https://i.ibb.co/Kc60ydzD/DALL-E-2025-02-08-22-07-58-A-wide-casino-bonus-gift-banner-in-a-luxurious-and-elegant-style-The-imag.webp"
    ]
    
    var body: some View {
        TabView(selection: $currentIndex) {
            ForEach(0..<imageUrls.count, id: \.self) { index in
                AsyncImage(url: URL(string: imageUrls[index])) { phase in
                    switch phase {
                    case .empty:
                        ProgressView()
                    case .success(let image):
                        image
                            .resizable()
                            .aspectRatio(contentMode: .fill)
                            .clipped()
                    case .failure(_):
                        Rectangle()
                            .fill(Color.gray.opacity(0.3))
                            .overlay(
                                Image(systemName: "photo")
                                    .foregroundColor(.white)
                            )
                    @unknown default:
                        EmptyView()
                    }
                }
            }
        }
        .tabViewStyle(PageTabViewStyle())
        .frame(height: 200)
    }
}

struct DetailedBonusView: View {
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            ScrollView {
                VStack(spacing: 20) {
                    // –í–µ—Ä—Ö–Ω–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    AsyncImage(url: URL(string: "https://i.ibb.co/cSkrTn0g/DALL-E-2025-02-08-22-11-30-A-luxury-Mercedes-Benz-car-wrapped-as-a-gift-The-car-is-adorned-with-a-la.webp")) { phase in
                        switch phase {
                        case .empty:
                            ProgressView()
                        case .success(let image):
                            image
                                .resizable()
                                .aspectRatio(contentMode: .fill)
                                .frame(maxWidth: .infinity)
                                .frame(height: 200)
                                .clipped()
                        case .failure(_):
                            Rectangle()
                                .fill(Color.gray.opacity(0.3))
                                .frame(height: 200)
                                .overlay(
                                    Image(systemName: "photo")
                                        .foregroundColor(.white)
                                )
                        @unknown default:
                            EmptyView()
                        }
                    }
                    
                    VStack(spacing: 15) {
                        Text("–®–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É üèéÔ∏è")
                            .font(.title)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                        
                        VStack(alignment: .leading, spacing: 20) {
                            Text("üéØ –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ Mercedes-Benz C-Class!")
                            Text("üìÖ –ü–µ—Ä–∏–æ–¥ –∞–∫—Ü–∏–∏: 1 –º–∞—Ä—Ç–∞ - 31 –º–∞—è 2025")
                            Text("üé≤ –ö–∞–∫ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å:")
                        }
                        .foregroundColor(.white)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("1Ô∏è‚É£ –î–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫–∏ –æ—Ç 100‚Ç¨")
                            Text("2Ô∏è‚É£ –ü–æ–ª—É—á–∞–π—Ç–µ 1 –±–∏–ª–µ—Ç –∑–∞ –∫–∞–∂–¥—ã–µ 100‚Ç¨ —Å—Ç–∞–≤–æ–∫")
                            Text("3Ô∏è‚É£ –ß–µ–º –±–æ–ª—å—à–µ –±–∏–ª–µ—Ç–æ–≤ - —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É!")
                        }
                        .foregroundColor(.white)
                        
                        Text("üéÅ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑—ã")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("ü•à 2 –º–µ—Å—Ç–æ - iPhone 15 Pro Max")
                            Text("ü•â 3 –º–µ—Å—Ç–æ - MacBook Air")
                            Text("4-10 –º–µ—Å—Ç–∞ - AirPods Pro")
                        }
                        .foregroundColor(.white)
                        
                        Text("‚≠ê –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("‚ú® VIP-–∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–≤–æ–π–Ω—ã–µ –±–∏–ª–µ—Ç—ã")
                            Text("üéØ –≠–∫—Å–ø—Ä–µ—Å—Å —Å—Ç–∞–≤–∫–∏ —Ö3 –±–∏–ª–µ—Ç–æ–≤")
                            Text("üî• –ö–∞–∂–¥—ã–µ –≤—ã—Ö–æ–¥–Ω—ã–µ: –±–æ–Ω—É—Å–Ω—ã–µ –±–∏–ª–µ—Ç—ã")
                        }
                        .foregroundColor(.white)
                        
                        Text("üìã –£—Å–ª–æ–≤–∏—è")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 1.5")
                            Text("‚úÖ –†–æ–∑—ã–≥—Ä—ã—à: 1 –∏—é–Ω—è 2025")
                            Text("‚úÖ –ü—Ä—è–º–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏")
                        }
                        .foregroundColor(.white)
                        
                        Text("üèÜ –ù–µ —É–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ–π —à–∞–Ω—Å –Ω–∞ Mercedes-Benz!")
                            .font(.headline)
                            .foregroundColor(.white)
                            .padding(.top)
                            .multilineTextAlignment(.center)
                    }
                    .padding()
                }
            }
        }
        .navigationBarTitle("–®–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É", displayMode: .inline)
    }
}

struct DotaBonusView: View {
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            Text("–ë–æ–Ω—É—Å Dota")
                .foregroundColor(.white)
        }
        .navigationBarTitle("–ë–æ–Ω—É—Å", displayMode: .inline)
    }
}

struct SpendPointsView: View {
    @State private var pointsToSpend: String = ""
    @State private var showAlert = false
    @State private var alertMessage = ""
    @State private var promoCode = ""
    @StateObject private var bonusManager = BonusManager.shared
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            VStack(spacing: 20) {
                // –ë–∞–ª–∞–Ω—Å
                VStack {
                    Text("–ë–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç")
                        .font(.subheadline)
                        .foregroundColor(.gray)
                    Text("\(bonusManager.bonusBalance) üéÅ")
                        .font(.title)
                        .fontWeight(.bold)
                        .foregroundColor(.white)
                }
                .frame(maxWidth: .infinity)
                .padding(.vertical, 15)
                .background(
                    RoundedRectangle(cornerRadius: 15)
                        .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                )
                .padding(.horizontal)
                
                // –ö—É—Ä—Å –æ–±–º–µ–Ω–∞
                Text("15 –±–∞–ª–ª–æ–≤ = 5 EUR –ø—Ä–æ–º–æ–∫–æ–¥")
                    .font(.title3)
                    .foregroundColor(.white)
                    .padding(.vertical, 10)
                
                // –ü–æ–ª–µ –≤–≤–æ–¥–∞
                TextField("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤", text: $pointsToSpend)
                    .keyboardType(.numberPad)
                    .textFieldStyle(CustomTextFieldStyle())
                    .padding(.horizontal)
                
                // –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
                Button(action: {
                    if let points = Int(pointsToSpend), points > 0 {
                        if points <= bonusManager.bonusBalance {
                            if points % 15 == 0 {
                                let promoValue = (points / 15) * 5
                                promoCode = "PROMO\(Int.random(in: 10000...99999))"
                                alertMessage = "–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ \(promoValue) EUR:"
                                bonusManager.bonusBalance -= points
                                showAlert = true
                            } else {
                                alertMessage = "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ 15"
                                promoCode = ""
                                showAlert = true
                            }
                        } else {
                            alertMessage = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤"
                            promoCode = ""
                            showAlert = true
                        }
                    } else {
                        alertMessage = "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤"
                        promoCode = ""
                        showAlert = true
                    }
                }) {
                    Text("–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥")
                        .font(.title3)
                        .bold()
                        .foregroundColor(.white)
                        .frame(maxWidth: .infinity)
                        .frame(height: 50)
                        .background(
                            RoundedRectangle(cornerRadius: 25)
                                .fill(Color.blue.opacity(0.8))
                        )
                }
                .padding(.horizontal)
            }
        }
        .navigationBarTitle("–û–±–º–µ–Ω –±–∞–ª–ª–æ–≤", displayMode: .inline)
        .alert(alertMessage, isPresented: $showAlert) {
            if !promoCode.isEmpty {
                Button(action: {
                    UIPasteboard.general.string = promoCode
                }) {
                    Text("–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å")
                }
                Button("OK", role: .cancel) { }
            } else {
                Button("OK", role: .cancel) { }
            }
        } message: {
            if !promoCode.isEmpty {
                Text(promoCode)
                    .font(.system(size: 20, weight: .bold))
            }
        }
    }
}

struct TapBonusView: View {
    @Environment(\.presentationMode) var presentationMode
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            ScrollView {
                VStack(spacing: 20) {
                    // –í–µ—Ä—Ö–Ω–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    AsyncImage(url: URL(string: "https://i.ibb.co/CKS6ht5n/DALL-E-2025-02-08-23-29-42-A-wide-sports-betting-image-featuring-a-soccer-ball-with-a-betting-theme.webp")) { phase in
                        switch phase {
                        case .empty:
                            ProgressView()
                        case .success(let image):
                            image
                                .resizable()
                                .aspectRatio(contentMode: .fill)
                                .frame(maxWidth: .infinity)
                                .frame(height: 200)
                                .clipped()
                        case .failure(_):
                            Rectangle()
                                .fill(Color.gray.opacity(0.3))
                                .frame(height: 200)
                                .overlay(
                                    Image(systemName: "photo")
                                        .foregroundColor(.white)
                                )
                        @unknown default:
                            EmptyView()
                        }
                    }
                    
                    VStack(spacing: 15) {
                        Text("–ú—è—á–∏–∫ –°—É–¥—å–±—ã ‚öΩüéÅ")
                            .font(.title)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                        
                        VStack(alignment: .leading, spacing: 20) {
                            Text("1Ô∏è‚É£ –û—Ç–∫—Ä—ã–≤–∞–π –º–∏–Ω–∏-–∏–≥—Ä—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (—Ä–∞–∑–¥–µ–ª \"–ú—è—á–∏–∫ –°—É–¥—å–±—ã\").")
                            Text("2Ô∏è‚É£ –¢–∞–ø–∞–π –ø–æ –º—è—á—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –±–∞–ª–ª—ã ‚öΩüî•.")
                            Text("3Ô∏è‚É£ –û–±–º–µ–Ω–∏–≤–∞–π –±–∞–ª–ª—ã –Ω–∞ –Ω–∞–≥—Ä–∞–¥—ã –≤ —Ä–∞–∑–¥–µ–ª–µ –±–æ–Ω—É—Å–æ–≤.")
                        }
                        .foregroundColor(.white)
                        
                        Text("üéÅ –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –±–∞–ª–ª—ã")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("üèÜ 1000 –±–∞–ª–ª–æ–≤ ‚Äì 5‚Ç¨ —Ñ—Ä–∏–±–µ—Ç –Ω–∞ —Å–ø–æ—Ä—Ç!")
                            Text("üéØ 2500 –±–∞–ª–ª–æ–≤ ‚Äì 15‚Ç¨ –±–æ–Ω—É—Å –Ω–∞ —ç–∫—Å–ø—Ä–µ—Å—Å—ã!")
                            Text("üí∞ 5000 –±–∞–ª–ª–æ–≤ ‚Äì 30‚Ç¨ –¥–ª—è live-—Å—Ç–∞–≤–æ–∫!")
                            Text("üîÆ 10000 –±–∞–ª–ª–æ–≤ ‚Äì –±–∏–ª–µ—Ç –≤ —Ä–æ–∑—ã–≥—Ä—ã—à 500‚Ç¨!")
                            Text(" 25000 –±–∞–ª–ª–æ–≤ ‚Äì VIP-—Å—Ç–∞—Ç—É—Å –∏ –∫–µ—à–±–µ–∫ 10% –Ω–∞ —Å—Ç–∞–≤–∫–∏!")
                        }
                        .foregroundColor(.white)
                        
                        Text("üî• –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—à–∫–∏")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("‚ö° –ë—É—Å—Ç–µ—Ä—ã ‚Äì –í—ã–ø–æ–ª–Ω—è–π —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –ø–æ–ª—É—á–∞–π x2 –∫ —Ç–∞–ø–∞–º!")
                            Text("üé≤ –°–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–∏–∑—ã ‚Äì –≤ \"–ú—è—á–∏–∫–µ –°—É–¥—å–±—ã\" –º–æ–∂–µ—Ç –≤—ã–ø–∞—Å—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å!")
                            Text("üî• –õ–∏–¥–µ—Ä–±–æ—Ä–¥ ‚Äì —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ–ª—É—á–∞—Ç 100‚Ç¨ —Ñ—Ä–∏–±–µ—Ç –≤ –∫–æ–Ω—Ü–µ –∞–∫—Ü–∏–∏!")
                        }
                        .foregroundColor(.white)
                        
                        Text("üìÖ –°—Ä–æ–∫–∏ –∞–∫—Ü–∏–∏: 1 –º–∞—Ä—Ç–∞ ‚Äì 31 –º–∞—Ä—Ç–∞")
                            .font(.headline)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        Text("‚úÖ –ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å?")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.top)
                        
                        VStack(alignment: .leading, spacing: 10) {
                            Text("‚úîÔ∏è –ò–≥—Ä–∞–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –±–æ–Ω—É—Å—ã üéÆüí∏")
                            Text("‚úîÔ∏è –¢–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –≤ \"—Ç–∞–ø–∞—Ö\" —Ä–µ—à–∞—é—Ç —Å—É–¥—å–±—É –≤—ã–∏–≥—Ä—ã—à–µ–π ‚ö°üèÜ")
                            Text("‚úîÔ∏è –ß–µ–º –±–æ–ª—å—à–µ —Ç–∞–ø–æ–≤ ‚Äì —Ç–µ–º –±–æ–ª—å—à–µ –Ω–∞–≥—Ä–∞–¥!")
                        }
                        .foregroundColor(.white)
                        
                        Text("‚öΩ –¢–∞–ø–∞–π, –∫–æ–ø–∏ –±–∞–ª–ª—ã –∏ –ø–æ–±–µ–∂–¥–∞–π –≤ \"–ú—è—á–∏–∫–µ –°—É–¥—å–±—ã\"! üî•üí∞")
                            .font(.headline)
                            .foregroundColor(.white)
                            .padding(.top)
                            .multilineTextAlignment(.center)
                    }
                    .padding()
                    
                    NavigationLink(destination: SpendPointsView()) {
                        Text("–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–∞–ª–ª—ã")
                            .font(.title3)
                            .bold()
                            .foregroundColor(.white)
                            .frame(width: 200, height: 50)
                            .background(
                                RoundedRectangle(cornerRadius: 25)
                                    .fill(Color.blue.opacity(0.8))
                            )
                    }
                    .padding(.top, 20)
                }
            }
            .navigationBarTitle("–ú—è—á–∏–∫ –°—É–¥—å–±—ã", displayMode: .inline)
        }
    }
}

struct BonusView: View {
    @Environment(\.presentationMode) var presentationMode
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            ScrollView {
                VStack(spacing: 20) {
                    BonusImageSlider()
                    
                    VStack(alignment: .leading, spacing: 10) {
                        Text("–°–ø–æ—Ä—Ç –±–æ–Ω—É—Å—ã")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.horizontal)
                        
                        LazyVGrid(columns: [
                            GridItem(.flexible()),
                            GridItem(.flexible()),
                            GridItem(.flexible())
                        ], spacing: 15) {
                            NavigationLink(destination: DetailedBonusView()) {
                                VStack {
                                    AsyncImage(url: URL(string: "https://i.ibb.co/cSkrTn0g/DALL-E-2025-02-08-22-11-30-A-luxury-Mercedes-Benz-car-wrapped-as-a-gift-The-car-is-adorned-with-a-la.webp")) { phase in
                                        switch phase {
                                        case .empty:
                                            ProgressView()
                                        case .success(let image):
                                            image
                                                .resizable()
                                                .aspectRatio(contentMode: .fill)
                                                .frame(width: 100, height: 100)
                                                .clipShape(RoundedRectangle(cornerRadius: 15))
                                        case .failure(_):
                                            RoundedRectangle(cornerRadius: 15)
                                                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                                .frame(height: 100)
                                        @unknown default:
                                            EmptyView()
                                        }
                                    }
                                    Text("—à–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É")
                                        .font(.caption)
                                        .foregroundColor(.white)
                                }
                            }
                            
                            NavigationLink(destination: TapBonusView()) {
                                VStack {
                                    AsyncImage(url: URL(string: "https://i.ibb.co/ksySvmBw/DALL-E-2025-02-08-23-27-47-A-realistic-and-detailed-image-of-a-soccer-ball-with-a-betting-theme-The.webp")) { phase in
                                        switch phase {
                                        case .empty:
                                            ProgressView()
                                        case .success(let image):
                                            image
                                                .resizable()
                                                .aspectRatio(contentMode: .fill)
                                                .frame(width: 100, height: 100)
                                                .clipShape(RoundedRectangle(cornerRadius: 15))
                                        case .failure(_):
                                            RoundedRectangle(cornerRadius: 15)
                                                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                                .frame(height: 100)
                                        @unknown default:
                                            EmptyView()
                                        }
                                    }
                                    Text("–¢–∞–ø–∞–π –±–∞–±–∫–∏")
                                        .font(.caption)
                                        .foregroundColor(.white)
                                }
                            }
                            
                            NavigationLink(destination: EmptyBonusView()) {
                                RoundedRectangle(cornerRadius: 15)
                                    .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                    .frame(height: 100)
                                    .overlay(
                                        Image(systemName: "gift.fill")
                                            .font(.system(size: 30))
                                            .foregroundColor(.white)
                                    )
                            }
                        }
                        .padding(.horizontal)
                    }
                    
                    // –ö–∞–∑–∏–Ω–æ –±–æ–Ω—É—Å—ã
                    VStack(alignment: .leading, spacing: 10) {
                        Text("–ö–∞–∑–∏–Ω–æ –±–æ–Ω—É—Å—ã")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.horizontal)
                        
                        LazyVGrid(columns: [
                            GridItem(.flexible()),
                            GridItem(.flexible()),
                            GridItem(.flexible())
                        ], spacing: 15) {
                            ForEach(0..<3) { _ in
                                NavigationLink(destination: EmptyBonusView()) {
                                    RoundedRectangle(cornerRadius: 15)
                                        .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                        .frame(height: 100)
                                        .overlay(
                                            Image(systemName: "gift.fill")
                                                .font(.system(size: 30))
                                                .foregroundColor(.white)
                                        )
                                }
                            }
                        }
                        .padding(.horizontal)
                    }
                    
                    // –ö–∏–±–µ—Ä –±–æ–Ω—É—Å—ã
                    VStack(alignment: .leading, spacing: 10) {
                        Text("–ö–∏–±–µ—Ä –±–æ–Ω—É—Å—ã")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                            .padding(.horizontal)
                        
                        LazyVGrid(columns: [
                            GridItem(.flexible()),
                            GridItem(.flexible()),
                            GridItem(.flexible())
                        ], spacing: 15) {
                            // –ü–µ—Ä–≤—ã–π –∫–≤–∞–¥—Ä–∞—Ç —Å –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                            NavigationLink(destination: DotaBonusView()) {
                                VStack {
                                    AsyncImage(url: URL(string: "https://i.ibb.co/rSMRkRc/DALL-E-2025-02-08-22-19-04-A-square-esports-bonus-gift-image-The-design-features-a-glowing-gift-box.webp")) { phase in
                                        switch phase {
                                        case .empty:
                                            ProgressView()
                                        case .success(let image):
                                            image
                                                .resizable()
                                                .aspectRatio(contentMode: .fill)
                                                .frame(width: 100, height: 100)
                                                .clipShape(RoundedRectangle(cornerRadius: 15))
                                        case .failure(_):
                                            RoundedRectangle(cornerRadius: 15)
                                                .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                                .frame(height: 100)
                                                .overlay(
                                                    Image(systemName: "photo")
                                                        .foregroundColor(.white)
                                                )
                                        @unknown default:
                                            EmptyView()
                                        }
                                    }
                                    Text("–±–æ—Ç –¥–æ—Ç—ã")
                                        .font(.caption)
                                        .foregroundColor(.white)
                                }
                            }
                            
                            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞
                            ForEach(0..<2) { _ in
                                NavigationLink(destination: EmptyBonusView()) {
                                    RoundedRectangle(cornerRadius: 15)
                                    git remote add origin                   .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                                        .frame(height: 100)
                                        .overlay(
                                            Image(systemName: "gift.fill")
                                                .font(.system(size: 30))
                                                .foregroundColor(.white)
                                        )
                                }
                            }
                        }
                        .padding(.horizontal)
                    }
                }
            }
            .navigationBarTitle("–ë–æ–Ω—É—Å—ã", displayMode: .inline)
        }
    }
}

struct EmptyBonusView: View {
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            Text("–ë–æ–Ω—É—Å —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è")
                .foregroundColor(.white)
        }
        .navigationBarTitle("–ë–æ–Ω—É—Å", displayMode: .inline)
    }
}

struct BallGameView: View {
    @State private var tapCount = 0
    @State private var smallBalls: [(id: UUID, offset: CGSize, opacity: Double)] = []
    @State private var isAnimating = false
    @State private var tapolkiBalance: Double = 1_000_000
    @StateObject private var bonusManager = BonusManager.shared
    @State private var isGameActive = false
    @State private var timeRemaining = 15 // 15 seconds
    @State private var cooldownRemaining = 0 // cooldown time in seconds
    @State private var showEarnedBonusAlert = false
    @State private var earnedBonus = 0
    let timer = Timer.publish(every: 1, on: .main, in: .common).autoconnect()
    
    var formattedTimeRemaining: String {
        let minutes = timeRemaining / 60
        let seconds = timeRemaining % 60
        return String(format: "%02d:%02d", minutes, seconds)
    }
    
    var formattedCooldownRemaining: String {
        let minutes = cooldownRemaining / 60
        let seconds = cooldownRemaining % 60
        return String(format: "%02d:%02d", minutes, seconds)
    }
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            VStack {
                // –ë–∞–ª–∞–Ω—Å –∏ –±–æ–Ω—É—Å—ã
                HStack(spacing: 15) {
                    // –ë–∞–ª–∞–Ω—Å —Ç–∞–ø–∞–ª–æ–∫
                    VStack {
                        Text("–ë–∞–ª–∞–Ω—Å —Ç–∞–ø–∞–ª–æ–∫")
                            .font(.subheadline)
                            .foregroundColor(.gray)
                        Text(String(format: "%.1f üéØ", tapolkiBalance))
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                    }
                    .frame(maxWidth: .infinity)
                    .padding(.vertical, 10)
                    .background(
                        RoundedRectangle(cornerRadius: 15)
                            .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                    )
                    
                    // –ë–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç
                    VStack {
                        Text("–ë–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç")
                            .font(.subheadline)
                            .foregroundColor(.gray)
                        Text("\(bonusManager.bonusBalance) üéÅ")
                            .font(.title3)
                            .fontWeight(.bold)
                            .foregroundColor(.white)
                    }
                    .frame(maxWidth: .infinity)
                    .padding(.vertical, 10)
                    .background(
                        RoundedRectangle(cornerRadius: 15)
                            .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                    )
                }
                .padding(.horizontal)
                .padding(.top, 20)
                
                // Timer display
                VStack(spacing: 5) {
                    if isGameActive {
                        Text("–í—Ä–µ–º—è –∏–≥—Ä—ã: \(formattedTimeRemaining)")
                            .font(.headline)
                            .foregroundColor(.green)
                    } else if cooldownRemaining > 0 {
                        Text("–°–ª–µ–¥—É—é—â–∞—è –∏–≥—Ä–∞ —á–µ—Ä–µ–∑: \(formattedCooldownRemaining)")
                            .font(.headline)
                            .foregroundColor(.orange)
                    } else {
                        Button(action: {
                            startGame()
                        }) {
                            Text("–ù–∞—á–∞—Ç—å –∏–≥—Ä—É")
                                .font(.headline)
                                .foregroundColor(.white)
                                .padding(.horizontal, 20)
                                .padding(.vertical, 10)
                                .background(Color.blue.opacity(0.8))
                                .cornerRadius(10)
                        }
                    }
                }
                .padding(.top, 10)
                
                Text("–ù–∞–∂–∞—Ç–∏–π: \(tapCount)")
                    .font(.title)
                    .fontWeight(.bold)
                    .foregroundColor(.white)
                    .padding(.top, 20)
                
                Spacer()
                
                AsyncImage(url: URL(string: "https://i.ibb.co/93YXW4L7/soccer-ball-in-vintage-style-on-grey-background-clipart-vector-633042-wh860.png")) { phase in
                    switch phase {
                    case .empty:
                        ProgressView()
                    case .success(let image):
                        image
                            .resizable()
                            .aspectRatio(contentMode: .fit)
                            .frame(width: 150, height: 150)
                            .padding(-20)
                            .clipShape(Circle())
                            .onTapGesture {
                                if isGameActive && tapolkiBalance >= 0.5 {
                                    tapCount += 1
                                    tapolkiBalance -= 0.5
                                    withAnimation(.spring()) {
                                        let newBall = (
                                            id: UUID(),
                                            offset: CGSize(width: 0, height: 0),
                                            opacity: 1.0
                                        )
                                        smallBalls.append(newBall)
                                        
                                        withAnimation(.easeOut(duration: 0.5)) {
                                            if let index = smallBalls.firstIndex(where: { $0.id == newBall.id }) {
                                                let angle = Double.random(in: 0...(2 * .pi))
                                                let mainBallRadius: CGFloat = 75
                                                let smallBallRadius: CGFloat = 20
                                                let startX = cos(angle) * (mainBallRadius + 2)
                                                let startY = sin(angle) * (mainBallRadius + 2)
                                                let distance: CGFloat = 150
                                                let endX = cos(angle) * distance
                                                let endY = sin(angle) * distance
                                                
                                                smallBalls[index].offset = CGSize(width: startX, height: startY)
                                                
                                                withAnimation(.easeOut(duration: 0.5)) {
                                                    smallBalls[index].offset = CGSize(width: endX, height: endY)
                                                }
                                            }
                                        }
                                        
                                        DispatchQueue.main.asyncAfter(deadline: .now() + 1.0) {
                                            withAnimation(.easeOut(duration: 1.0)) {
                                                if let index = smallBalls.firstIndex(where: { $0.id == newBall.id }) {
                                                    smallBalls[index].opacity = 0
                                                }
                                            }
                                        }
                                        
                                        DispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {
                                            smallBalls.removeAll(where: { $0.id == newBall.id })
                                        }
                                        
                                        if smallBalls.count > 10 {
                                            smallBalls.removeFirst()
                                        }
                                    }
                                }
                            }
                    case .failure(_):
                        Image(systemName: "photo")
                            .resizable()
                            .aspectRatio(contentMode: .fit)
                            .frame(width: 150, height: 150)
                            .foregroundColor(.white)
                    @unknown default:
                        EmptyView()
                    }
                }
                .opacity(isGameActive ? 1.0 : 0.5)
                
                Spacer()
            }
            
            ForEach(smallBalls, id: \.id) { ball in
                AsyncImage(url: URL(string: "https://i.ibb.co/93YXW4L7/soccer-ball-in-vintage-style-on-grey-background-clipart-vector-633042-wh860.png")) { phase in
                    switch phase {
                    case .success(let image):
                        image
                            .resizable()
                            .aspectRatio(contentMode: .fit)
                            .frame(width: 40, height: 40)
                            .padding(-5)
                            .clipShape(Circle())
                            .offset(ball.offset)
                            .opacity(ball.opacity)
                    default:
                        Image(systemName: "photo")
                            .resizable()
                            .aspectRatio(contentMode: .fit)
                            .frame(width: 40, height: 40)
                            .foregroundColor(.white)
                            .offset(ball.offset)
                            .opacity(ball.opacity)
                    }
                }
            }
        }
        .navigationBarTitle("–ú—è—á–∏–∫ —Å—É–¥—å–±—ã", displayMode: .inline)
        .alert("–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!", isPresented: $showEarnedBonusAlert) {
            Button("OK", role: .cancel) { }
        } message: {
            Text("–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ \(earnedBonus) –±–æ–Ω—É—Å–Ω—ã—Ö –æ—á–∫–æ–≤! üéâ")
        }
        .onReceive(timer) { _ in
            if isGameActive {
                if timeRemaining > 0 {
                    timeRemaining -= 1
                } else {
                    endGame()
                }
            } else if cooldownRemaining > 0 {
                cooldownRemaining -= 1
            }
        }
    }
    
    private func startGame() {
        isGameActive = true
        timeRemaining = 15 // 15 seconds
        tapCount = 0
        smallBalls.removeAll()
    }
    
    private func endGame() {
        isGameActive = false
        cooldownRemaining = 1740 // 29 minutes (30 - 1 = 29)
        earnedBonus = tapCount
        bonusManager.bonusBalance += tapCount
        showEarnedBonusAlert = true
        tapCount = 0
        smallBalls.removeAll()
    }
}

struct MainGameView: View {
    var body: some View {
        NavigationView {
            ZStack {
                Color(red: 0.1, green: 0.1, blue: 0.2)
                    .ignoresSafeArea()
                
                ScrollView {
                    VStack(spacing: 20) {
                        ImageSlider()
                        
                        HStack(spacing: 10) {
                            CategorySquare(title: "–°–ø–æ—Ä—Ç")
                            CategorySquare(title: "–ö–∞–∑–∏–Ω–æ")
                            CategorySquare(title: "Games")
                        }
                        .padding(.horizontal)
                        
                        // –ü–ª–∞—à–∫–∞ –±–æ–Ω—É—Å–æ–≤
                        NavigationLink(destination: BonusView()) {
                            HStack {
                                Text("–ë–æ–Ω—É—Å—ã")
                                    .font(.headline)
                                    .foregroundColor(.white)
                                Spacer()
                                Image(systemName: "chevron.right")
                                    .foregroundColor(.white)
                            }
                            .padding()
                            .background(
                                RoundedRectangle(cornerRadius: 15)
                                    .fill(Color(red: 0.2, green: 0.2, blue: 0.3))
                            )
                            .padding(.horizontal)
                        }
                        
                        VStack(spacing: 15) {
                            GameBlock(
                                game: "–§—É—Ç–±–æ–ª - –ü—Ä–µ–º—å–µ—Ä –õ–∏–≥–∞",
                                team1: "–ê—Ä—Å–µ–Ω–∞–ª",
                                team2: "–ú–∞–Ω—á–µ—Å—Ç–µ—Ä –°–∏—Ç–∏",
                                odds: ("1.85", "3.40", "2.10")
                            )
                            
                            GameBlock(
                                game: "–§—É—Ç–±–æ–ª - –õ–∞ –õ–∏–≥–∞",
                                team1: "–†–µ–∞–ª –ú–∞–¥—Ä–∏–¥",
                                team2: "–ë–∞—Ä—Å–µ–ª–æ–Ω–∞",
                                odds: ("2.10", "3.20", "1.95")
                            )
                            
                            GameBlock(
                                game: "–§—É—Ç–±–æ–ª - –°–µ—Ä–∏—è –ê",
                                team1: "–ò–Ω—Ç–µ—Ä",
                                team2: "–ú–∏–ª–∞–Ω",
                                odds: ("1.75", "3.50", "2.30")
                            )
                            
                            GameBlock(
                                game: "–§—É—Ç–±–æ–ª - –ë—É–Ω–¥–µ—Å–ª–∏–≥–∞",
                                team1: "–ë–∞–≤–∞—Ä–∏—è",
                                team2: "–ë–æ—Ä—É—Å—Å–∏—è –î",
                                odds: ("1.65", "3.60", "2.40")
                            )
                            
                            GameBlock(
                                game: "–§—É—Ç–±–æ–ª - –õ–∏–≥–∞ 1",
                                team1: "–ü–°–ñ",
                                team2: "–ú–∞—Ä—Å–µ–ª—å",
                                odds: ("1.55", "3.80", "2.50")
                            )
                        }
                        .padding(.horizontal)
                    }
                    .padding(.bottom, 30)
                }
            }
        }
    }
}

struct LoginView: View {
    @State private var login = ""
    @State private var password = ""
    @State private var showError = false
    @EnvironmentObject var userData: UserData
    
    var body: some View {
        ZStack {
            Color(red: 0.1, green: 0.1, blue: 0.2)
                .ignoresSafeArea()
            
            ScrollView {
                VStack(spacing: 20) {
                    Text("–í—Ö–æ–¥")
                        .font(.largeTitle)
                        .foregroundColor(.white)
                        .padding(.top, 30)
                    
                    VStack(spacing: 15) {
                        TextField("–õ–æ–≥–∏–Ω", text: $login)
                            .textFieldStyle(CustomTextFieldStyle())
                            .autocapitalization(.none)
                        
                        SecureField("–ü–∞—Ä–æ–ª—å", text: $password)
                            .textFieldStyle(CustomTextFieldStyle())
                    }
                    .padding(.horizontal)
                    
                    Button(action: {
                        if userData.validateCredentials(login: login, password: password) {
                            userData.isLoggedIn = true
                        } else {
                            showError = true
                        }
                    }) {
                        Text("–í–æ–π—Ç–∏")
                            .font(.title3)
                            .bold()
                            .foregroundColor(.white)
                            .frame(maxWidth: .infinity)
                            .frame(height: 50)
                            .background(
                                RoundedRectangle(cornerRadius: 25)
                                    .fill(Color.blue.opacity(0.8))
                            )
                    }
                    
                    Button(action: {}) {
                        Text("–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?")
                            .foregroundColor(.blue)
                            .padding(.top, 10)
                    }
                }
                .padding(.bottom, 30)
            }
        }
        .alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞", isPresented: $showError) {
            Button("OK", role: .cancel) { }
        } message: {
            Text("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å")
        }
    }
}

struct WelcomeView: View {
    @EnvironmentObject var userData: UserData
    
    var body: some View {
        NavigationView {
            ZStack {
                Color(red: 0.1, green: 0.1, blue: 0.2)
                    .ignoresSafeArea()
                
                VStack(spacing: 30) {
                    Spacer()
                    
                    Image(systemName: "sportscourt.fill")
                        .font(.system(size: 80))
                        .foregroundColor(.white)
                    
                    Text("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BetApp")
                        .font(.largeTitle)
                        .fontWeight(.bold)
                        .foregroundColor(.white)
                        .multilineTextAlignment(.center)
                        .padding(.horizontal)
                    
                    Text("–î–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫–∏ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ")
                        .font(.title3)
                        .foregroundColor(.gray)
                    
                    Spacer()
                    
                    NavigationLink(destination: LoginView().environmentObject(userData)) {
                        Text("–í–æ–π—Ç–∏")
                            .font(.title3)
                            .bold()
                            .foregroundColor(.white)
                            .frame(maxWidth: .infinity)
                            .frame(height: 50)
                            .background(
                                RoundedRectangle(cornerRadius: 25)
                                    .fill(Color.blue.opacity(0.8))
                            )
                    }
                    .padding(.horizontal, 30)
                    .padding(.bottom, 50)
                }
            }
        }
    }
}

// Add this before struct ContentView
class BonusManager: ObservableObject {
    @Published var bonusBalance: Int {
        didSet {
            UserDefaults.standard.set(bonusBalance, forKey: "bonusBalance")
        }
    }
    
    static let shared = BonusManager()
    
    init() {
        self.bonusBalance = UserDefaults.standard.integer(forKey: "bonusBalance")
    }
}

struct ContentView: View {
    @StateObject private var userData = UserData()
    
    var body: some View {
        Group {
            if userData.isLoggedIn {
                GameView()
                    .environmentObject(userData)
            } else {
                WelcomeView()
                    .environmentObject(userData)
            }
        }
    }
}

#Preview {
    ContentView()
}

